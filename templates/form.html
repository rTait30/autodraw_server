<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Config Creator</title>
    <style>
        .tab { display: none; }
        .tab.active { display: block; }
        .tab-buttons button { margin-right: 10px; }
        pre.output { background: #f0f0f0; padding: 10px; margin-top: 10px; white-space: pre-wrap; }
    
        body {
            font-family: Arial, sans-serif;
        }

        .form-grid {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            gap: 20px;
            margin-top: 20px;
            align-items: flex-start;
        }

        .config-section {
            flex: 1;
            min-width: 250px;
        }

        .config-section h3 {
            margin-top: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-family: Arial, sans-serif;
        }

        table th,
        table td {
            padding: 6px 8px;
            border: 1px solid #ccc;
            text-align: left;
        }

        input, select, button {
            font-family: Arial, sans-serif;
        }
    
    </style>
</head>
<body>
    <h1>Submit a New Config</h1>

    <!-- Tabs -->
    <div class="tab-buttons">
        <button onclick="showTab('shadeSail')">Shade Sails</button>
        <button onclick="showTab('surgicalCovers')">Surgical Covers</button>
    </div>

    <!-- Shade Sails Form -->
    <div id="shadeSail" class="tab active">
        <h2>Shade Sails Config</h2>
        <form id="formShadeSail">
            <label>
                Company Name:
                <input type="text" id="companyName" placeholder="Company Name">
            </label><br>
        
            <label>
                Job Name:
                <input type="text" id="jobName" placeholder="Job Name">
            </label><br>
        
            <label>
                Number of Corners:
                <input type="number" id="cornerCount" placeholder="Number of Corners" onchange="generateEdgeInputs()">
            </label><br><br>

            <div class="form-grid">
                <div class="config-section" id="edgesContainer"></div>
                <div class="config-section" id="diagonalsContainer"></div>
                <div class="config-section" id="pointsContainer"></div>
            </div>
        
            <br><button type="button" onclick="submitForm('shadesail')">Save Shade Sails Config</button>
        </form>
    </div>

    <!-- Surgical Covers Form -->
    <div id="surgicalCovers" class="tab">
        <h2>Surgical Covers Config</h2>
        <form id="formSurgicalCovers">
            <input type="text" id="surgicalName" placeholder="Name"><br>
            <input type="number" id="surgicalLength" placeholder="Length"><br>
            <input type="number" id="surgicalWidth" placeholder="Width"><br>
            <input type="number" id="surgicalHeight" placeholder="Height"><br>
            <input type="number" id="surgicalQuantity" placeholder="Quantity"><br><br>
            <button type="button" onclick="submitForm('surgical')">Save Surgical Covers Config</button>
        </form>
    </div>

    <hr>

    <!-- Uploaded configs list -->
    <h2>Uploaded Configs</h2>
    <div id="configsList"></div>

    <script>
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
        }

        function submitForm(category) {
            let data = { category };

            if (category === 'shadesail') {
                data.company = document.getElementById('companyName').value;
                data.job = document.getElementById('jobName').value;
                const cornerCount = parseInt(document.getElementById('cornerCount').value);
                data.corners = cornerCount;

                // Edges
                data.edges = {};
                for (let i = 0; i < cornerCount; i++) {
                    const from = String.fromCharCode(65 + i);
                    const to = String.fromCharCode(65 + ((i + 1) % cornerCount));
                    const key = `${from}-${to}`;
                    const input = document.querySelector(`input[name="edge-${key}"]`);
                    if (input && input.value) {
                        data.edges[key] = parseFloat(input.value);
                    }
                }

                // Diagonals
                data.diagonals = {};
                for (let i = 0; i < cornerCount; i++) {
                    for (let j = i + 2; j < cornerCount + (i > 0 ? 0 : -1); j++) {
                        const from = String.fromCharCode(65 + i);
                        const to = String.fromCharCode(65 + (j % cornerCount));
                        const key = `${from}-${to}`;
                        const input = document.querySelector(`input[name="diag-${key}"]`);
                        if (input && input.value) {
                            data.diagonals[key] = parseFloat(input.value);
                        }
                    }
                }

                // Points
                data.points = {};
                for (let i = 0; i < cornerCount; i++) {
                    const label = String.fromCharCode(65 + i);
                    const heightInput = document.querySelector(`input[name="height-${label}"]`);
                    const fixingSelect = document.querySelector(`select[name="fixing-${label}"]`);
                    if (heightInput && fixingSelect) {
                        data.points[label] = {
                            height: parseFloat(heightInput.value),
                            fixing: fixingSelect.value
                        };
                    }
                }
            }

            // Surgical config handling remains the same
            else if (category === 'surgical') {
                data.name = document.getElementById('surgicalName').value;
                data.length = parseFloat(document.getElementById('surgicalLength').value);
                data.width = parseFloat(document.getElementById('surgicalWidth').value);
                data.height = parseFloat(document.getElementById('surgicalHeight').value);
                data.quantity = parseFloat(document.getElementById('surgicalQuantity').value);
            }

            // Submit
            fetch('/copelands/save_config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(response => {
                alert("Saved successfully!");
                loadConfigs();  // Reload the configs list after saving
            });
        }

        function loadConfigs() {
            const categories = ['shadesail', 'surgical'];
            let allConfigsHTML = '';

            categories.forEach(category => {
                fetch('/copelands/list_configs/' + category)
                    .then(res => res.json())
                    .then(files => {
                        if (files.length > 0) {
                            allConfigsHTML += `<h3>${category}</h3><ul>`;
                            files.forEach(file => {
                                allConfigsHTML += `<li><a href="/get_config/${category}/${file}" target="_blank">${file}</a></li>`;
                            });
                            allConfigsHTML += `</ul>`;
                        }
                        document.getElementById('configsList').innerHTML = allConfigsHTML;
                    });
            });
        }

        window.onload = loadConfigs;

        const FIXING_TYPES = ['Long Dee Shackle', 'Dee Shackle', 'Long Shackle', 'M8 Turnbuckle', 'M10 Turnbuckle', 'M12 Turnbuckle', 'M8 Toggle Bolt', 'M10 Toggle Bolt', 'M12 Toggle Bolt', 'Direct'];

        function generateEdgeInputs() {
            const count = parseInt(document.getElementById('cornerCount').value);
            if (isNaN(count) || count < 3) return;

            const edgeContainer = document.getElementById('edgesContainer');
            const diagContainer = document.getElementById('diagonalsContainer');
            const pointContainer = document.getElementById('pointsContainer');

            edgeContainer.innerHTML = `<h3>Edges</h3><table id="edgesTable"><tr><th>Edge</th><th>Length (m)</th></tr></table>`;
            diagContainer.innerHTML = `<h3>Diagonals</h3><table id="diagonalsTable"><tr><th>Diagonal</th><th>Length (m)</th></tr></table>`;
            pointContainer.innerHTML = `<h3>Points</h3><table id="pointsTable"><tr><th>Point</th><th>Height (m)</th><th>Fixing</th></tr></table>`;

            const edgeTable = document.getElementById('edgesTable');
            const diagTable = document.getElementById('diagonalsTable');
            const pointTable = document.getElementById('pointsTable');

            // Edges
            for (let i = 0; i < count; i++) {
                const from = String.fromCharCode(65 + i);
                const to = String.fromCharCode(65 + ((i + 1) % count));
                const row = edgeTable.insertRow();
                row.innerHTML = `<td>${from}-${to}</td><td><input type="number" name="edge-${from}-${to}" step="0.01"></td>`;
            }

            // Diagonals
            for (let i = 0; i < count; i++) {
                for (let j = i + 2; j < count + (i > 0 ? 0 : -1); j++) {
                    const from = String.fromCharCode(65 + i);
                    const to = String.fromCharCode(65 + (j % count));
                    const row = diagTable.insertRow();
                    row.innerHTML = `<td>${from}-${to}</td><td><input type="number" name="diag-${from}-${to}" step="0.01"></td>`;
                }
            }

            // Points
            for (let i = 0; i < count; i++) {
                const label = String.fromCharCode(65 + i);
                const row = pointTable.insertRow();
                const select = `<select name="fixing-${label}">${FIXING_TYPES.map(f => `<option>${f}</option>`).join('')}</select>`;
                row.innerHTML = `<td>${label}</td><td><input type="number" name="height-${label}" step="0.01"></td><td>${select}</td>`;
            }
        }
    </script>
</body>
</html>
